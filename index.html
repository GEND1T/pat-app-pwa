<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>PAT Jungle Adventure</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2d5a27">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/GEND1T/pat-app/master/avatars/icon-192.png">
    
    <style>
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            width: 100%; 
            overflow: hidden; 
            background-color: #2d5a27; 
        }
        
        #iframe-wrapper {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        iframe { 
            border: none; 
            display: block;
        }

        /* === CSS MAGIC TRICK (Skala 20%) === */
        
        /* Tampilan Default (Desktop/Laptop): Normal */
        iframe {
            width: 100%;
            height: 100%;
        }

        /* KHUSUS HP (Layar di bawah 768px) */
        @media (max-width: 768px) {
            iframe {
                /* Logika: 100% dibagi 0.2 = 500% */
                /* Kita lebarkan ruang geraknya jadi 5x lipat... */
                width: 285%;  
                height: 285%; 
                
                /* ...Lalu kita kecilkan tampilannya jadi 20% */
                transform: scale(0.35);
                transform-origin: 0 0; /* Titik pengecilan dari pojok kiri atas */
            }
        }
    </style>
</head>
<body>
    <div id="iframe-wrapper">
        <iframe 
            id="app-frame" 
            src=""
            allow="camera *; geolocation *; microphone *" 
            allowfullscreen>
        </iframe>
    </div>

    <script>
        // --- KONFIGURASI URL ---
        const gasUrl = "https://script.google.com/macros/s/AKfycbw3U16MfAGQ2_-kCB1B-l5xKgBfi3KtOvtc1MnBmTVrxZOlPKvpNL9t1Dm0rhHU4lN2/exec";

        // --- LOGIKA PASSING ID ---
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const userId = urlParams.get('id');

        let targetSrc = gasUrl;
        
        if (userId) {
            const separator = targetSrc.includes('?') ? '&' : '?';
            targetSrc += separator + "id=" + userId;
        }

        document.getElementById('app-frame').src = targetSrc;

        // --- SERVICE WORKER ---
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(console.error);
        }
    </script>

    <div id="ios-warning" style="display:none; position:fixed; bottom:0; left:0; width:100%; background:#dc2626; color:white; padding:15px; text-align:center; z-index:99999; font-family:sans-serif;">
    <p style="margin:0 0 10px 0;">‚ö†Ô∏è Menggunakan iPhone/Safari?</p>
    <p style="font-size:0.8rem; margin:0 0 10px 0;">Jika aplikasi tidak berjalan lancar (Login gagal/Blank), buka versi Fullscreen:</p>
    <a id="direct-link" href="#" target="_blank" style="background:white; color:#dc2626; padding:8px 15px; border-radius:20px; text-decoration:none; font-weight:bold; display:inline-block;">Buka Fullscreen üöÄ</a>
    <button onclick="document.getElementById('ios-warning').style.display='none'" style="background:none; border:1px solid white; color:white; padding:5px 10px; border-radius:10px; margin-left:10px;">Tutup</button>
</div>

<script>
    // Deteksi jika user menggunakan iOS (iPhone/iPad)
    function isIOS() {
        return [
            'iPad Simulator',
            'iPhone Simulator',
            'iPod Simulator',
            'iPad',
            'iPhone',
            'iPod'
        ].includes(navigator.platform)
        // iPad on iOS 13 detection
        || (navigator.userAgent.includes("Mac") && "ontouchend" in document);
    }

    // Jika iOS DAN berada di dalam Iframe
    if (isIOS() && window.self !== window.top) {
        var gasUrl = "https://script.google.com/macros/s/AKfycbw3U16MfAGQ2_-kCB1B-l5xKgBfi3KtOvtc1MnBmTVrxZOlPKvpNL9t1Dm0rhHU4lN2/exec"; // URL Script App Kamu
        
        // Pasang link ke tombol
        document.getElementById('direct-link').href = gasUrl;
        // Tampilkan peringatan
        document.getElementById('ios-warning').style.display = 'block';
    }
</script>
</body>
</html>
